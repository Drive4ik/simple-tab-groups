<!DOCTYPE html>
<html>
<head>
    <title>Debug viewer</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iY29sb3Itc2NoZW1lOiBsaWdodCBkYXJrOyIgZmlsbD0iY29udGV4dC1maWxsIGxpZ2h0LWRhcmsoIzViNWI2NiwjZmJmYmZlKSI+PHBhdGggZD0iTTI1NiAwYzUzIDAgOTYgNDMgOTYgOTZ2My42YzAgMTUuNy0xMi43IDI4LjQtMjguNCAyOC40SDE4OC40Yy0xNS43IDAtMjguNC0xMi43LTI4LjQtMjguNFY5NmMwLTUzIDQzLTk2IDk2LTk2ek00MS40IDEwNS40YzEyLjUtMTIuNSAzMi44LTEyLjUgNDUuMyAwbDY0IDY0Yy43IC43IDEuMyAxLjQgMS45IDIuMWMxNC4yLTcuMyAzMC40LTExLjQgNDcuNS0xMS40SDMxMmMxNy4xIDAgMzMuMiA0LjEgNDcuNSAxMS40Yy42LS43IDEuMi0xLjQgMS45LTIuMWw2NC02NGMxMi41LTEyLjUgMzIuOC0xMi41IDQ1LjMgMHMxMi41IDMyLjggMCA0NS4zbC02NCA2NGMtLjcgLjctMS40IDEuMy0yLjEgMS45YzYuMiAxMiAxMC4xIDI1LjMgMTEuMSAzOS41SDQ4MGMxNy43IDAgMzIgMTQuMyAzMiAzMnMtMTQuMyAzMi0zMiAzMkg0MTZjMCAyNC42LTUuNSA0Ny44LTE1LjQgNjguNmMyLjIgMS4zIDQuMiAyLjkgNiA0LjhsNjQgNjRjMTIuNSAxMi41IDEyLjUgMzIuOCAwIDQ1LjNzLTMyLjggMTIuNS00NS4zIDBsLTYzLjEtNjMuMWMtMjQuNSAyMS44LTU1LjggMzYuMi05MC4zIDM5LjZWMjQwYzAtOC44LTcuMi0xNi0xNi0xNnMtMTYgNy4yLTE2IDE2VjQ3OS4yYy0zNC41LTMuNC02NS44LTE3LjgtOTAuMy0zOS42TDg2LjYgNTAyLjZjLTEyLjUgMTIuNS0zMi44IDEyLjUtNDUuMyAwcy0xMi41LTMyLjggMC00NS4zbDY0LTY0YzEuOS0xLjkgMy45LTMuNCA2LTQuOEMxMDEuNSAzNjcuOCA5NiAzNDQuNiA5NiAzMjBIMzJjLTE3LjcgMC0zMi0xNC4zLTMyLTMyczE0LjMtMzIgMzItMzJIOTYuM2MxLjEtMTQuMSA1LTI3LjUgMTEuMS0zOS41Yy0uNy0uNi0xLjQtMS4yLTIuMS0xLjlsLTY0LTY0Yy0xMi41LTEyLjUtMTIuNS0zMi44IDAtNDUuM3oiLz48L3N2Zz4="/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/1.0.4/css/bulma.min.css" integrity="sha512-yh2RE0wZCVZeysGiqTwDTO/dKelCbS9bP2L94UvOFtl/FKXcNAje3Y2oBg/ZMZ3LS1sicYk4dYVGtDex75fvvA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        details {
            border: 1px solid #aaa;
            border-radius: 4px;
            padding: 0.5em 0.5em 0;

            &[open] {
                padding: 0.5em;

                summary {
                    border-bottom: 1px solid #aaa;
                    margin-bottom: 0.5em;
                }
            }

            summary {
                font-weight: bold;
                margin: -0.5em -0.5em 0;
                padding: 0.5em;
            }
        }

        .host:not(:first-child) {
            margin-left: 1.5rem;
        }

        input {
            color-scheme: light dark;
        }

        .stack-icon {
            background-repeat: no-repeat;
            background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIiBzdHlsZT0iY29sb3Itc2NoZW1lOiBsaWdodCBkYXJrOyIgZmlsbD0iY29udGV4dC1maWxsIGxpZ2h0LWRhcmsoIzViNWI2NiwjZmJmYmZlKSI+PHBhdGggZD0iTTI2NC41IDUuMmMxNC45LTYuOSAzMi4xLTYuOSA0NyAwbDIxOC42IDEwMWM4LjUgMy45IDEzLjkgMTIuNCAxMy45IDIxLjhzLTUuNCAxNy45LTEzLjkgMjEuOGwtMjE4LjYgMTAxYy0xNC45IDYuOS0zMi4xIDYuOS00NyAwTDQ1LjkgMTQ5LjhDMzcuNCAxNDUuOCAzMiAxMzcuMyAzMiAxMjhzNS40LTE3LjkgMTMuOS0yMS44TDI2NC41IDUuMnpNNDc2LjkgMjA5LjZsNTMuMiAyNC42YzguNSAzLjkgMTMuOSAxMi40IDEzLjkgMjEuOHMtNS40IDE3LjktMTMuOSAyMS44bC0yMTguNiAxMDFjLTE0LjkgNi45LTMyLjEgNi45LTQ3IDBMNDUuOSAyNzcuOEMzNy40IDI3My44IDMyIDI2NS4zIDMyIDI1NnM1LjQtMTcuOSAxMy45LTIxLjhsNTMuMi0yNC42IDE1MiA3MC4yYzIzLjQgMTAuOCA1MC40IDEwLjggNzMuOCAwbDE1Mi03MC4yem0tMTUyIDE5OC4ybDE1Mi03MC4yIDUzLjIgMjQuNmM4LjUgMy45IDEzLjkgMTIuNCAxMy45IDIxLjhzLTUuNCAxNy45LTEzLjkgMjEuOGwtMjE4LjYgMTAxYy0xNC45IDYuOS0zMi4xIDYuOS00NyAwTDQ1LjkgNDA1LjhDMzcuNCA0MDEuOCAzMiAzOTMuMyAzMiAzODRzNS40LTE3LjkgMTMuOS0yMS44bDUzLjItMjQuNiAxNTIgNzAuMmMyMy40IDEwLjggNTAuNCAxMC44IDczLjggMHoiLz48L3N2Zz4=");
        }

        .highlight-icon {
            background-repeat: no-repeat;
            background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIiBzdHlsZT0iY29sb3Itc2NoZW1lOiBsaWdodCBkYXJrOyIgZmlsbD0iY29udGV4dC1maWxsIGxpZ2h0LWRhcmsoIzViNWI2NiwjZmJmYmZlKSI+PHBhdGggZD0iTTMxNSAzMTVsMTU4LjQtMjE1TDQ0NC4xIDcwLjYgMjI5IDIyOSAzMTUgMzE1em0tMTg3IDVsMCAwVjI0OC4zYzAtMTUuMyA3LjItMjkuNiAxOS41LTM4LjZMNDIwLjYgOC40QzQyOCAyLjkgNDM3IDAgNDQ2LjIgMGMxMS40IDAgMjIuNCA0LjUgMzAuNSAxMi42bDU0LjggNTQuOGM4LjEgOC4xIDEyLjYgMTkgMTIuNiAzMC41YzAgOS4yLTIuOSAxOC4yLTguNCAyNS42TDMzNC40IDM5Ni41Yy05IDEyLjMtMjMuNCAxOS41LTM4LjYgMTkuNUgyMjRsLTI1LjQgMjUuNGMtMTIuNSAxMi41LTMyLjggMTIuNS00NS4zIDBsLTUwLjctNTAuN2MtMTIuNS0xMi41LTEyLjUtMzIuOCAwLTQ1LjNMMTI4IDMyMHpNNyA0NjYuM2w2My02MyA3MC42IDcwLjYtMzEgMzFjLTQuNSA0LjUtMTAuNiA3LTE3IDdIMjRjLTEzLjMgMC0yNC0xMC43LTI0LTI0di00LjdjMC02LjQgMi41LTEyLjUgNy0xN3oiLz48L3N2Zz4=");
        }

        .log.indent-line[data-action="START"]::before {
            content: "";
            display: block;
            position: absolute;
            left: 0;
            top: 100%;
            width: 2px;
            height: var(--indent-line-height, 20px);
            border-left: 2px dotted red;
        }

        code {
            word-break: break-all;

            + code {
                margin-left: 10px;
            }
        }

        [v-cloak] {
            display: none;
        }

        #page-navigation {
            position: fixed;
            right: 32px;
            top: 70px;
        }

        .log {
            word-wrap: anywhere;
            width: 94vw;
        }

        pre {
            padding: 0.25rem 0.5rem;
        }

        .v-middle {
            vertical-align: middle;
        }

        code.expanded-on-focus {
            &:focus {
                white-space: pre-wrap;
                display: block;
                margin-top: 1em;
            }

            &:not(:focus) {
                max-width: 500px;
                display: inline-block;
                max-height: 2em;
                overflow: hidden;
                vertical-align: bottom;

                &::before {
                    content: "(click to expand)";
                    display: inline-block;
                }
            }
        }
    </style>
</head>
<body>
    <div id="app" class="container is-fluid pt-4" style="margin-bottom: 200px;" v-cloak>
        <div class="file is-fullwidth is-info has-name">
            <label class="file-label">
                <input class="file-input" type="file" @change="changeFile" accept="application/json" />
                <span class="file-cta">
                    <span class="file-icon">
                        <span class="icon">
                            <figure class="image is-16x16">
                                <img v-if="fileLoading" src="https://github.com/Drive4ik/simple-tab-groups/raw/refs/heads/master/addon/src/icons/animate-spinner.svg">
                                <img v-else src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/refs/heads/7.x/svgs/solid/upload.svg">
                            </figure>
                        </span>
                    </span>
                    <span class="file-label">Select debug file...</span>
                </span>
                <span v-if="fileName" class="file-name" v-text="fileName"></span>
                <span v-else class="file-name">No file uploaded</span>
            </label>
        </div>
        <div v-if="file" class="field">
            <template v-if="file.CRITICAL_ERRORS.length">
                <h1 class="title has-text-centered has-background-danger">CRITICAL_ERRORS</h1>
                <pre class="field">{{file.CRITICAL_ERRORS | json}}</pre>
            </template>

            <h1 class="title has-text-centered">info</h1>
            <div class="columns">
                <div class="column is-narrow">
                    Version: <span class="tag is-info has-text-weight-bold">{{addon.version}}</span><br>
                    UP time: <code>{{upTime}}</code><br>
                    UUID: <code>{{addon.UUID}}</code><br>
                    <div v-for="(val, key) in addon.permissions" :key="key + 'perm'" class="control mt-1">
                        <div class="tags has-addons">
                            <span class="tag">{{key}}</span>
                            <span :class="['tag', val ? 'is-success' : 'is-info']">{{val}}</span>
                        </div>
                    </div>
                    <div v-for="(val, key) in options" :key="key + 'opt'">
                        <template v-if="isBool(val)">
                            <input type="checkbox" onclick="return false" :checked="val"> {{key}}
                        </template>
                        <template v-else-if="isString(val) || isNumber(val)">
                            {{key}}: "{{val}}"
                        </template>
                        <template v-else>
                            {{key}}: <pre>{{val | json(true)}}</pre>
                        </template>
                    </div>
                </div>
                <div class="column">
                    <div class="field is-grouped is-grouped-multiline">
                        <div v-for="(val, key) in file.browserInfo.browserAndOS" :key="key + 'browser'" class="control">
                            <div class="tags has-addons">
                                <span class="tag">{{key}}</span>
                                <span class="tag is-info">{{val}}</span>
                            </div>
                        </div>
                    </div>

                    <hr style="width: 100%;" class="mb-2 mt-0">

                    <h2 class="subtitle">Addons</h2>
                    <div class="field is-grouped is-grouped-multiline is-flex-direction-column">
                        <div v-for="(ext, i) in file.browserInfo.extensions" :key="i + 'ext'" class="control">
                            <div class="columns">
                                <div class="column is-narrow">
                                    <span class="tag">
                                        <img v-if="ext.icon_url" class="image is-16x16 mr-2" :src="ext.icon_url">
                                        <a v-if="ext.url" :href="ext.url" target="_blank">{{ext.name}} {{ext.version}}</a>
                                        <span v-else>{{ext.name}} {{ext.version}}</span>
                                    </span>
                                </div>
                                <div class="column">
                                    <code class="host" v-for="(host, i) in ext.hostPermissions" :key="i + 'host'" v-text="host"></code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <h1 id="windows-title" class="title has-text-centered">windows</h1>
            <details v-for="(win, i) in file.windows" :key="i + 'win'" class="field">
                <summary>windowId: {{win?.id}} {{win?.groupId && `(groupId: ${win.groupId})`}}</summary>
                <pre class="field">{{win | json}}</pre>
            </details>

            <h1 id="tabsWithoutGroup-title" class="title has-text-centered">tabs without group</h1>
            <details class="field">
                <summary>tabs without group (count: {{tabsWithoutGroup.length}})</summary>
                <pre class="field">{{tabsWithoutGroup | json}}</pre>
            </details>

            <h1 id="groups-title" class="title has-text-centered">groups (count: {{groups.length}})</h1>
            <details v-for="(group, i) in groups" :key="i + 'group'" class="field">
                <summary>groupId: {{group?.id}} {{ group?.isArchive ? '(archived)' : ''}} (tabs: {{group.tabs.length}})</summary>
                <pre class="field">{{group | json}}</pre>
            </details>


            <h1 id="logs-title" class="title has-text-centered mt-5">logs (count: {{logs.length}})</h1>
            <div id="logs" class="is-relative" :style="{
                    marginLeft: logsIndent + 'px',
                }">
                <div v-for="(log, i) in logs" :key="i + 'log'" :data-action="log.action" :data-key="log.key"
                    :class="['is-relative field log p-1', {
                        'has-background-success-soft indent-line': isHighlighted(log),
                        'has-background-info-soft': isHighlighted(log, true),
                    }]"
                    :style="{
                        marginLeft: log.indent,
                        '--indent-line-height': log.indentLineHeight,
                    }">
                    <span class="is-size-7 v-middle" v-html="formatTime(log)"></span>

                    <button @click="toggleShowStack(log)" class="button is-small">
                        <span class="stack-icon icon"></span>
                    </button>
                    <button v-if="log.action" @click="toggleHighlight(log)" class="button is-small">
                        <span class="highlight-icon icon"></span>
                    </button>

                    <span class="v-middle" v-html="getLogTitle(log)"></span>
                    <div v-if="log.showStack">
                        <pre v-for="(stack, i) in log.stacks" :key="i + 'stack' + stack[0]" class="mt-3" v-text="getStackToView(stack)"></pre>
                    </div>
                </div>
            </div>


            <h1 id="errors-title" class="title has-text-centered">ERRORS</h1>
            <div v-for="(log, i) in errorLogs" :key="i + 'error'" class="field log p-1">
                <span class="is-size-7" v-html="formatTime(log, true)"></span>

                <button @click="toggleShowStack(log)" class="button is-small">
                    <span class="stack-icon icon"></span>
                </button>
                <!-- <button v-if="log.action" @click="toggleHighlight(log)" class="button is-small">
                    <span class="highlight-icon icon"></span>
                </button> -->

                <span v-html="getLogTitle(log)"></span>
                <div v-if="log.showStack">
                    <pre v-for="stack in log.stacks" :key="i + 'stack2' + stack[0]" class="mt-3" v-text="getStackToView(stack)"></pre>
                </div>
            </div>

            <div id="page-navigation" class="buttons is-flex-direction-column is-align-items-end">
                <button class="button" @click="scrollTo('input[type=file]')">top</button>
                <button class="button" @click="scrollTo('#windows-title', 'start')">windows</button>
                <button class="button" @click="scrollTo('#groups-title', 'start')">groups</button>
                <button class="button" @click="scrollTo('#logs-title', 'start')">logs</button>
                <div class="buttons are-small m-0">
                    <button class="button" @click="logsIndent += 50" @contextmenu.prevent="logsIndent += 200">‚óÅ</button>
                    <button class="button" @click="logsIndent -= 50" @contextmenu.prevent="logsIndent -= 200">‚ñ∑</button>
                </div>
                <button class="button" title="Right click - prev error"
                    @click="scrollTo('#logs .tag.is-danger:not(.is-light), .has-background-danger', undefined, true)"
                    @contextmenu.prevent.stop="scrollTo('#logs .tag.is-danger:not(.is-light), .has-background-danger', undefined, true, true)">üõë error</button>
                <button class="button" @click="scrollTo('#errors-title')">errors</button>
            </div>

        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.7.16/vue.js" integrity="sha512-LnT1nhi1a/7Iu/cSAwUdqMMTSrh6WXC15R9Tge+5IY4EanqNDRuSPy0Sf9ls2qE1EnKmfb1IZYTWL/WHu/40VA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript" src="./debug-viewer.js"></script>
</body>
</html>
